#!/bin/sh
# FETA few shot - run on all manufacturers except for Nissan which has a more training documents and thus considered many shot
python -m torch.distributed.launch --nproc_per_node $GPU_NUM -m training.main --exp_mode few --fold 0 --distributed --data_mode cm --name feta_few_shot_0 --batch-size 32 --lr 5e-05 --epochs 20 --model RN50 --logs $LOGS_FOLDER --train-data $DATA_ROOT/car_manuals_data/car_manuals_data.pkl --val-data $DATA_ROOT/car_manuals_data/car_manuals_data.pkl --openai-pretrained --save-frequency 50
python -m torch.distributed.launch --nproc_per_node $GPU_NUM -m training.main --exp_mode few --fold 1 --distributed --data_mode cm --name feta_few_shot_1 --batch-size 32 --lr 5e-05 --epochs 20 --model RN50 --logs $LOGS_FOLDER --train-data $DATA_ROOT/car_manuals_data/car_manuals_data.pkl --val-data $DATA_ROOT/car_manuals_data/car_manuals_data.pkl --openai-pretrained --save-frequency 50
python -m torch.distributed.launch --nproc_per_node $GPU_NUM -m training.main --exp_mode few --fold 3 --distributed --data_mode cm --name feta_few_shot_3 --batch-size 32 --lr 5e-05 --epochs 20 --model RN50 --logs $LOGS_FOLDER --train-data $DATA_ROOT/car_manuals_data/car_manuals_data.pkl --val-data $DATA_ROOT/car_manuals_data/car_manuals_data.pkl --openai-pretrained --save-frequency 50
python -m torch.distributed.launch --nproc_per_node $GPU_NUM -m training.main --exp_mode few --fold 4 --distributed --data_mode cm --name feta_few_shot_4 --batch-size 32 --lr 5e-05 --epochs 20 --model RN50 --logs $LOGS_FOLDER --train-data $DATA_ROOT/car_manuals_data/car_manuals_data.pkl --val-data $DATA_ROOT/car_manuals_data/car_manuals_data.pkl --openai-pretrained --save-frequency 50
# Average results
python training/utils.py --logs_path $LOGS_FOLDER --run_name feta_few_shot --exp_mode few